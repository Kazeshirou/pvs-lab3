\documentclass[a4paper,12pt]{article}

\input{header.tex}

\title{Отчёт по лабораторной работе \\ <<Механизмы протокола TCP>>}
\author{Жаровой Наталии Александровны}

\begin{document}

\maketitle

\tableofcontents

% Текст отчёта должен быть читаемым!!! Написанное здесь является рыбой.

\section{Однопоточный чат на select}

Код сервера. 
\input{includes/echo_server.tex}

Код клиента. 
\input{includes/echo_client.tex}


\section{Установка и разрыв соединения}

С c1 (10.10.0.2) подключаемся к c6 (10.50.0.2), отсылаем несколько строчек и разрываем соединение.

\begin{Verbatim}
c1:~# telnet 10.50.0.2 9
Trying 10.50.0.2...
Connected to 10.50.0.2.
Escape character is '^]'.
one
two
three
^]
telnet> q
Connection closed.
\end{Verbatim}

Дамп с c2 (10.10.0.1).

\begin{Verbatim}
c2:~# tcpdump -n -i eth0 tcp
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
20:38:48.288032 IP 10.10.0.2.58443 > 10.50.0.2.9: 
    S 3914370038:3914370038(0) win 5840 <mss 1460,sackOK,timestamp 330821 0,nop,wscale 1>
20:38:48.327241 IP 10.50.0.2.9 > 10.10.0.2.58443: 
    S 3918055579:3918055579(0) ack 3914370039 win 5792 
        <mss 536,sackOK,timestamp 330395 330821,nop,wscale 1>
20:38:48.327516 IP 10.10.0.2.58443 > 10.50.0.2.9: 
    . ack 1 win 2920 <nop,nop,timestamp 330832 330395>
20:39:09.999603 IP 10.10.0.2.58443 > 10.50.0.2.9: 
    P 1:6(5) ack 1 win 2920 <nop,nop,timestamp 333001 330395>
20:39:10.000808 IP 10.50.0.2.9 > 10.10.0.2.58443: 
    . ack 6 win 2896 <nop,nop,timestamp 332562 333001>
20:39:11.971356 IP 10.10.0.2.58443 > 10.50.0.2.9: 
    P 6:11(5) ack 1 win 2920 <nop,nop,timestamp 333198 332562>
20:39:11.972405 IP 10.50.0.2.9 > 10.10.0.2.58443: 
    . ack 11 win 2896 <nop,nop,timestamp 332759 333198>
20:39:14.441228 IP 10.10.0.2.58443 > 10.50.0.2.9: 
    P 11:18(7) ack 1 win 2920 <nop,nop,timestamp 333445 332759>
20:39:14.442558 IP 10.50.0.2.9 > 10.10.0.2.58443: 
    . ack 18 win 2896 <nop,nop,timestamp 333006 333445>
20:39:29.859443 IP 10.10.0.2.58443 > 10.50.0.2.9: 
    F 18:18(0) ack 1 win 2920 <nop,nop,timestamp 334987 333006>
20:39:29.863838 IP 10.50.0.2.9 > 10.10.0.2.58443: 
    F 1:1(0) ack 19 win 2896 <nop,nop,timestamp 334549 334987>
20:39:29.864247 IP 10.10.0.2.58443 > 10.50.0.2.9: 
    . ack 2 win 2920 <nop,nop,timestamp 334987 334549>
\end{Verbatim}

Дамп с c3 (10.20.0.2).

\begin{Verbatim}
c3:~# tcpdump -n -i eth0 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
20:38:48.305310 IP 10.10.0.2.58443 > 10.50.0.2.9: 
    S 3914370038:3914370038(0) win 5840 <mss 1460,sackOK,timestamp 330821 0,nop,wscale 1>
20:38:48.329652 IP 10.50.0.2.9 > 10.10.0.2.58443: 
    S 3918055579:3918055579(0) ack 3914370039 win 5792 
        <mss 536,sackOK,timestamp 330395 330821,nop,wscale 1>
20:38:48.330318 IP 10.10.0.2.58443 > 10.50.0.2.9: 
    . ack 1 win 2920 <nop,nop,timestamp 330832 330395>
20:39:10.002470 IP 10.10.0.2.58443 > 10.50.0.2.9: 
    P 1:6(5) ack 1 win 2920 <nop,nop,timestamp 333001 330395>
20:39:10.003230 IP 10.50.0.2.9 > 10.10.0.2.58443: 
    . ack 6 win 2896 <nop,nop,timestamp 332562 333001>
20:39:11.974239 IP 10.10.0.2.58443 > 10.50.0.2.9: 
    P 6:11(5) ack 1 win 2920 <nop,nop,timestamp 333198 332562>
20:39:11.974948 IP 10.50.0.2.9 > 10.10.0.2.58443: 
    . ack 11 win 2896 <nop,nop,timestamp 332759 333198>
20:39:14.444132 IP 10.10.0.2.58443 > 10.50.0.2.9: 
    P 11:18(7) ack 1 win 2920 <nop,nop,timestamp 333445 332759>
20:39:14.445051 IP 10.50.0.2.9 > 10.10.0.2.58443: 
    . ack 18 win 2896 <nop,nop,timestamp 333006 333445>
20:39:29.862280 IP 10.10.0.2.58443 > 10.50.0.2.9: 
    F 18:18(0) ack 1 win 2920 <nop,nop,timestamp 334987 333006>
20:39:29.866328 IP 10.50.0.2.9 > 10.10.0.2.58443: 
    F 1:1(0) ack 19 win 2896 <nop,nop,timestamp 334549 334987>
20:39:29.867042 IP 10.10.0.2.58443 > 10.50.0.2.9: 
    . ack 2 win 2920 <nop,nop,timestamp 334987 334549>
\end{Verbatim}

\section{Окно получателя}

На с4 (10.30.0.2) запущена программа win: 
\begin{Verbatim}
./win 3002 2 1
\end{Verbatim}

На c1 (10.10.0.2) : 
\begin{Verbatim}
c1:~# netcat 10.30.0.2 3002 < /dev/zero
\end{Verbatim}

Дамп с c3 (10.20.0.2).

%окно получателя до нуля
\begin{Verbatim}
c3:~# tcpdump -n -i eth0 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
09:01:35.790361 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    S 693180048:693180048(0) win 5840 
        <mss 1460,sackOK,timestamp 4787572 0,nop,wscale 1>
09:01:35.800103 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    S 695349641:695349641(0) ack 693180049 win 2096 
        <mss 536,sackOK,timestamp 4787260 4787572,nop,wscale 1>
09:01:35.801026 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.801330 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 1:525(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.801417 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 525:1049(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.801525 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 525 win 1572 <nop,nop,timestamp 4787260 4787580>
09:01:35.801558 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 1049 win 2096 <nop,nop,timestamp 4787260 4787580>
09:01:35.801948 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    P 1049:1573(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.802026 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 1573:2097(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.802112 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 2097:2621(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.802121 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    P 2621:3145(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.802162 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 1573 win 2620 <nop,nop,timestamp 4787260 4787580>
09:01:35.802219 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 2097 win 3144 <nop,nop,timestamp 4787260 4787580>
09:01:35.802227 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 2621 win 3668 <nop,nop,timestamp 4787260 4787580>
09:01:35.802251 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 3145 win 4192 <nop,nop,timestamp 4787260 4787580>
09:01:35.802742 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 3145:3669(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.802764 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 3669:4193(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.802999 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    P 4193:4717(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.803035 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 3669 win 4716 <nop,nop,timestamp 4787260 4787580>
09:01:35.803051 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 4193 win 5240 <nop,nop,timestamp 4787260 4787580>
09:01:35.803184 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 4717 win 5764 <nop,nop,timestamp 4787260 4787580>
09:01:35.803763 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 4717:5241(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.803786 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 5241:5765(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.803822 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    P 5765:6289(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.803831 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 6289:6813(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.803838 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 6813:7337(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.803985 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 5241 win 6288 <nop,nop,timestamp 4787260 4787580>
09:01:35.804000 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 5765 win 6812 <nop,nop,timestamp 4787260 4787580>
09:01:35.804034 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 6289 win 7336 <nop,nop,timestamp 4787260 4787580>
09:01:35.804042 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 6813 win 7860 <nop,nop,timestamp 4787260 4787580>
09:01:35.804050 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 7337 win 8384 <nop,nop,timestamp 4787260 4787580>
09:01:35.804519 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    P 7337:7861(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.804535 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 7861:8385(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.804544 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 8385:8909(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.804552 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    P 8909:9433(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.804560 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 9433:9957(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.804567 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 9957:10481(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.804631 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 10481:11005(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.804670 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 11005:11529(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.804756 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 11529:12053(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.804797 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 12053:12577(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.804829 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 12577:13101(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.804837 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 13101:13625(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.804865 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    P 13625:14149(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.804873 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 14149:14673(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.804903 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 14673:15197(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.804912 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 15197:15721(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.805255 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 7861 win 8384 <nop,nop,timestamp 4787260 4787580>
09:01:35.805280 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 8385 win 8384 <nop,nop,timestamp 4787260 4787580>
09:01:35.805289 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 9433 win 8384 <nop,nop,timestamp 4787260 4787580>
09:01:35.805331 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 10481 win 8384 <nop,nop,timestamp 4787260 4787580>
09:01:35.805339 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 11529 win 8384 <nop,nop,timestamp 4787260 4787580>
09:01:35.805347 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 12577 win 8384 <nop,nop,timestamp 4787260 4787580>
09:01:35.805355 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 13625 win 8384 <nop,nop,timestamp 4787260 4787580>
09:01:35.805363 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 14673 win 8384 <nop,nop,timestamp 4787260 4787580>
09:01:35.805386 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 15721 win 8384 <nop,nop,timestamp 4787260 4787580>
09:01:35.806023 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 15721:16245(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.806061 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 16245:16769(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.806090 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 16769:17293(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.806099 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 17293:17817(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.806126 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 17817:18341(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.806134 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 18341:18865(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.806162 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 18865:19389(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.806170 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 19389:19913(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.806197 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 19913:20437(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.806205 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 20437:20961(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.806232 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 20961:21485(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.806240 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 21485:22009(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.806268 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 22009:22533(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.806276 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    P 22533:23057(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.806303 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 23057:23581(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.806311 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 23581:24105(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.806335 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    P 24105:24577(472) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.806785 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 16769 win 8384 <nop,nop,timestamp 4787260 4787580>
09:01:35.806798 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 17817 win 8384 <nop,nop,timestamp 4787260 4787580>
09:01:35.806806 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 18865 win 8384 <nop,nop,timestamp 4787260 4787580>
09:01:35.806832 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 24577:25101(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.807150 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 25101:25625(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.807193 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 25625:26149(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.807260 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 26149:26673(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.807812 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 26673:27197(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.808014 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 27197:27721(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.808199 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 27721:28245(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.808213 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 28245:28769(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.808222 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 28769:29293(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.808250 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 27721 win 3956 <nop,nop,timestamp 4787260 4787580>
09:01:35.808439 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 28245 win 3694 <nop,nop,timestamp 4787260 4787580>
09:01:35.808454 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 28769 win 3432 <nop,nop,timestamp 4787260 4787580>
09:01:35.808462 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 29293 win 3170 <nop,nop,timestamp 4787260 4787580>
09:01:35.808524 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 29293:29817(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.808557 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 29817:30341(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.808580 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 30341:30865(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.808603 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 30865:31389(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.808632 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 31389:31913(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.808640 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 31913:32437(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.808832 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 29817 win 3144 <nop,nop,timestamp 4787260 4787580>
09:01:35.808850 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 30341 win 3668 <nop,nop,timestamp 4787260 4787580>
09:01:35.808858 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 30865 win 4192 <nop,nop,timestamp 4787260 4787580>
09:01:35.808867 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 31389 win 4716 <nop,nop,timestamp 4787260 4787580>
09:01:35.808896 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 31913 win 5240 <nop,nop,timestamp 4787260 4787580>
09:01:35.808904 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 32437 win 5764 <nop,nop,timestamp 4787260 4787580>
09:01:35.809070 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 32437:32961(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.809282 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 32961 win 6288 <nop,nop,timestamp 4787260 4787580>
09:01:35.809344 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 32961:33485(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.809438 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 33485:34009(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.809478 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 34009:34533(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.809487 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 34533:35057(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.809508 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 35057:35581(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.809687 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 33485 win 6812 <nop,nop,timestamp 4787260 4787580>
09:01:35.809702 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 34009 win 7336 <nop,nop,timestamp 4787260 4787580>
09:01:35.809731 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 34533 win 7860 <nop,nop,timestamp 4787260 4787580>
09:01:35.809739 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 35057 win 8384 <nop,nop,timestamp 4787260 4787580>
09:01:35.809929 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 35581:36105(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.810093 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 36105 win 8384 <nop,nop,timestamp 4787260 4787580>
09:01:35.810173 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 36105:36629(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.810205 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 36629:37153(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.810239 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 37153:37677(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.811161 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 37677:38201(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.811191 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 38201:38725(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.811327 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 38725:39249(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.811348 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 39249:39773(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.811389 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 39773:40297(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.811398 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 40297:40821(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.811406 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 40821:41345(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.811413 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    P 41345:41869(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.811452 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 41869:42393(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.811461 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 42393:42917(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.811468 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 42917:43441(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.811480 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 37153 win 8384 <nop,nop,timestamp 4787260 4787580>
09:01:35.811516 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 43441:43965(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.811525 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 43965:44489(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.811533 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 44489:45013(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.811541 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 45013:45537(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.811582 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 45537:46061(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.811591 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 46061:46585(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.811599 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 46585:47109(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.811606 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 47109:47633(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.811645 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 47633:48157(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.811654 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 48157:48681(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.811662 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 48681:49205(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.811669 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 49205:49729(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.811703 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 49729:50253(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.811711 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 50253:50777(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.811719 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 50777:51301(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.811752 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 51301:51825(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.811762 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 51825:52349(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.811770 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 52349:52873(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.812505 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 52873:53397(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.812528 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 53397:53921(524) ack 1 win 2920 <nop,nop,timestamp 4787580 4787260>
09:01:35.837756 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 53921 win 4118 <nop,nop,timestamp 4787264 4787580>
09:01:35.838777 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 53921:54445(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.838803 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 54445:54969(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.838812 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 54969:55493(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.838820 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 55493:56017(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.838827 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 56017:56541(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.838835 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 56541:57065(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.838843 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    P 57065:57589(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.838850 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 57589:58113(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.838858 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 58113:58637(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.838866 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 58637:59161(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.838874 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 59161:59685(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.838882 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 59685:60209(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.838890 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 60209:60733(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.838897 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 60733:61257(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.838904 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 61257:61781(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.839346 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 61781 win 4192 <nop,nop,timestamp 4787264 4787583>
09:01:35.839997 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 61781:62305(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.840152 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 62305:62829(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.840185 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 62829:63353(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.840220 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 63353:63877(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.840257 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 63877:64401(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.840834 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 64401:64925(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.840851 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 64925:65449(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.840859 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 65449:65973(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.840867 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 65973:66497(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.840875 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 66497:67021(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.840883 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 67021:67545(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.840890 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 67545:68069(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.840898 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 68069:68593(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.840905 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 68593:69117(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.840913 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 69117:69641(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.840920 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 69641:70165(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.840933 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 62305 win 4256 <nop,nop,timestamp 4787264 4787583>
09:01:35.841528 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 70165:70689(524) ack 1 win 2920 <nop,nop,timestamp 4787583 4787264>
09:01:35.877783 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 70689 win 794 <nop,nop,timestamp 4787268 4787583>
09:01:35.878704 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 70689:71213(524) ack 1 win 2920 <nop,nop,timestamp 4787587 4787268>
09:01:35.878741 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    P 71213:71737(524) ack 1 win 2920 <nop,nop,timestamp 4787587 4787268>
09:01:35.878752 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 71737:72261(524) ack 1 win 2920 <nop,nop,timestamp 4787587 4787268>
09:01:35.879131 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 72261 win 1048 <nop,nop,timestamp 4787268 4787587>
09:01:35.879746 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 72261:72785(524) ack 1 win 2920 <nop,nop,timestamp 4787587 4787268>
09:01:35.879776 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 72785:73309(524) ack 1 win 2920 <nop,nop,timestamp 4787587 4787268>
09:01:35.879811 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 73309:73833(524) ack 1 win 2920 <nop,nop,timestamp 4787587 4787268>
09:01:35.879821 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 73833:74357(524) ack 1 win 2920 <nop,nop,timestamp 4787587 4787268>
09:01:35.880428 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 72785 win 1572 <nop,nop,timestamp 4787268 4787587>
09:01:35.880447 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 73309 win 1970 <nop,nop,timestamp 4787268 4787587>
09:01:35.881149 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 74357:74881(524) ack 1 win 2920 <nop,nop,timestamp 4787587 4787268>
09:01:35.881187 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 74881:75405(524) ack 1 win 2920 <nop,nop,timestamp 4787587 4787268>
09:01:35.881197 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 75405:75929(524) ack 1 win 2920 <nop,nop,timestamp 4787587 4787268>
09:01:35.881235 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 75929:76453(524) ack 1 win 2920 <nop,nop,timestamp 4787587 4787268>
09:01:35.881245 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 76453:76977(524) ack 1 win 2920 <nop,nop,timestamp 4787587 4787268>
09:01:35.917765 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 76977 win 464 <nop,nop,timestamp 4787272 4787587>
09:01:35.918741 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . 76977:77501(524) ack 1 win 2920 <nop,nop,timestamp 4787591 4787272>
09:01:35.957787 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 77501 win 202 <nop,nop,timestamp 4787276 4787591>
09:01:36.170899 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    P 77501:77905(404) ack 1 win 2920 <nop,nop,timestamp 4787617 4787276>
09:01:36.171322 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 77905 win 0 <nop,nop,timestamp 4787297 4787617>
09:01:36.390859 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . ack 1 win 2920 <nop,nop,timestamp 4787639 4787297>
09:01:36.391388 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 77905 win 0 <nop,nop,timestamp 4787319 4787617>
09:01:36.830831 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . ack 1 win 2920 <nop,nop,timestamp 4787683 4787319>
09:01:36.831371 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 77905 win 0 <nop,nop,timestamp 4787363 4787617>
09:01:37.710769 IP 10.10.0.2.50830 > 10.30.0.2.3002: 
    . ack 1 win 2920 <nop,nop,timestamp 4787771 4787363>
09:01:37.711305 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    . ack 77905 win 0 <nop,nop,timestamp 4787451 4787617>
09:01:37.809235 IP 10.30.0.2.3002 > 10.10.0.2.50830: 
    R 1:1(0) ack 77905 win 1572 <nop,nop,timestamp 4787461 4787617>
\end{Verbatim}

\section{Окно отправителя}

На машине с1 запускаем ./nagle nodelay 10.40.0.2 9 1 20.

Дамп на с2:
\begin{Verbatim}
c2:~# tcpdump -n -i eth0 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
13:22:05.112811 IP 10.10.0.2.38377 > 10.40.0.2.9: 
    S 3433464865:3433464865(0) win 5840 
        <mss 1460,sackOK,timestamp 65050 0,nop,wscale 1>
13:22:05.222607 IP 10.40.0.2.9 > 10.10.0.2.38377: 
    S 3434154186:3434154186(0) ack 3433464866 win 5792 
        <mss 1460,sackOK,timestamp 64647 65050,nop,wscale 1>
13:22:05.223099 IP 10.10.0.2.38377 > 10.40.0.2.9: 
    . ack 1 win 2920 <nop,nop,timestamp 65062 64647>
13:22:05.223355 IP 10.10.0.2.38377 > 10.40.0.2.9: 
    P 1:101(100) ack 1 win 2920 <nop,nop,timestamp 65062 64647>
13:22:05.229732 IP 10.10.0.2.38377 > 10.40.0.2.9: 
    P 101:201(100) ack 1 win 2920 <nop,nop,timestamp 65064 64647>
13:22:05.332575 IP 10.40.0.2.9 > 10.10.0.2.38377: 
    . ack 101 win 2896 <nop,nop,timestamp 64658 65062>
13:22:05.332606 IP 10.40.0.2.9 > 10.10.0.2.38377: 
    . ack 201 win 2896 <nop,nop,timestamp 64658 65064>
13:22:05.332922 IP 10.10.0.2.38377 > 10.40.0.2.9: 
    P 201:1201(1000) ack 1 win 2920 <nop,nop,timestamp 65073 64658>
13:22:05.337708 IP 10.10.0.2.38377 > 10.40.0.2.9: 
    P 1201:1301(100) ack 1 win 2920 <nop,nop,timestamp 65075 64658>
13:22:05.345078 IP 10.10.0.2.38377 > 10.40.0.2.9: 
    P 1301:1401(100) ack 1 win 2920 <nop,nop,timestamp 65075 64658>
13:22:05.355098 IP 10.10.0.2.38377 > 10.40.0.2.9: 
    P 1401:1501(100) ack 1 win 2920 <nop,nop,timestamp 65076 64658>
13:22:05.415971 IP 10.10.0.2.38377 > 10.40.0.2.9: 
    FP 1501:2001(500) ack 1 win 2920 <nop,nop,timestamp 65082 64658>
13:22:05.442560 IP 10.40.0.2.9 > 10.10.0.2.38377: 
    . ack 1201 win 3896 <nop,nop,timestamp 64669 65073>
13:22:05.442866 IP 10.40.0.2.9 > 10.10.0.2.38377: 
    . ack 1301 win 3896 <nop,nop,timestamp 64669 65075>
13:22:05.452456 IP 10.40.0.2.9 > 10.10.0.2.38377: 
    . ack 1401 win 3896 <nop,nop,timestamp 64669 65075>
13:22:05.462457 IP 10.40.0.2.9 > 10.10.0.2.38377: 
    . ack 1501 win 3896 <nop,nop,timestamp 64671 65076>
13:22:05.522689 IP 10.40.0.2.9 > 10.10.0.2.38377: 
    F 1:1(0) ack 2002 win 4896 <nop,nop,timestamp 64677 65082>
13:22:05.523196 IP 10.10.0.2.38377 > 10.40.0.2.9: 
    . ack 2 win 2920 <nop,nop,timestamp 65092 64677>
\end{Verbatim}

На машине с1 запускаем ./nagle nodelay 10.40.0.2 9 1 50.

Дамп на с2:
\begin{Verbatim}
c2:~# tcpdump -n -i eth0 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
13:28:24.465292 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    S 793226044:793226044(0) win 5840 
        <mss 1460,sackOK,timestamp 102986 0,nop,wscale 1>
13:28:24.686776 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    S 790084363:790084363(0) ack 793226045 win 5792 
        <mss 1460,sackOK,timestamp 102593 102986,nop,wscale 1>
13:28:24.687228 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    . ack 1 win 2920 <nop,nop,timestamp 103009 102593>
13:28:24.687412 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 1:101(100) ack 1 win 2920 <nop,nop,timestamp 103009 102593>
13:28:24.697453 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 101:201(100) ack 1 win 2920 <nop,nop,timestamp 103011 102593>
13:28:24.792563 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 101 win 2896 <nop,nop,timestamp 102604 103009>
13:28:24.792970 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 201:1101(900) ack 1 win 2920 <nop,nop,timestamp 103019 102604>
13:28:24.797745 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 1101:1201(100) ack 1 win 2920 <nop,nop,timestamp 103021 102604>
13:28:24.805662 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 201 win 2896 <nop,nop,timestamp 102604 103011>
13:28:24.806101 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 1201:1301(100) ack 1 win 2920 <nop,nop,timestamp 103021 102604>
13:28:24.815645 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 1301:1401(100) ack 1 win 2920 <nop,nop,timestamp 103022 102604>
13:28:24.902532 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 1101 win 3796 <nop,nop,timestamp 102615 103019>
13:28:24.902563 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 1201 win 3796 <nop,nop,timestamp 102615 103021>
13:28:24.903045 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 1401:2201(800) ack 1 win 2920 <nop,nop,timestamp 103030 102615>
13:28:24.907618 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 2201:2301(100) ack 1 win 2920 <nop,nop,timestamp 103032 102615>
13:28:24.915048 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 2301:2401(100) ack 1 win 2920 <nop,nop,timestamp 103032 102615>
13:28:24.920435 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 1301 win 3796 <nop,nop,timestamp 102616 103021>
13:28:24.920476 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 1401 win 3796 <nop,nop,timestamp 102617 103022>
13:28:24.927686 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 2401:2501(100) ack 1 win 2920 <nop,nop,timestamp 103034 102617>
13:28:24.935005 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 2501:2601(100) ack 1 win 2920 <nop,nop,timestamp 103034 102617>
13:28:24.945138 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 2601:2701(100) ack 1 win 2920 <nop,nop,timestamp 103035 102617>
13:28:24.955148 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 2701:2801(100) ack 1 win 2920 <nop,nop,timestamp 103036 102617>
13:28:24.965080 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 2801:2901(100) ack 1 win 2920 <nop,nop,timestamp 103037 102617>
13:28:25.012477 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 2201 win 4696 <nop,nop,timestamp 102626 103030>
13:28:25.012506 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 2301 win 4696 <nop,nop,timestamp 102626 103032>
13:28:25.012811 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 2901:3301(400) ack 1 win 2920 <nop,nop,timestamp 103041 102626>
13:28:25.018141 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 3301:3401(100) ack 1 win 2920 <nop,nop,timestamp 103043 102626>
13:28:25.024963 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 3401:3501(100) ack 1 win 2920 <nop,nop,timestamp 103043 102626>
13:28:25.024999 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 2401 win 4696 <nop,nop,timestamp 102626 103032>
13:28:25.032496 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 2501 win 4696 <nop,nop,timestamp 102628 103034>
13:28:25.037733 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 3501:3601(100) ack 1 win 2920 <nop,nop,timestamp 103045 102628>
13:28:25.044008 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 2601 win 4696 <nop,nop,timestamp 102629 103034>
13:28:25.051558 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 3601:3701(100) ack 1 win 2920 <nop,nop,timestamp 103046 102629>
13:28:25.054816 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 2701 win 4696 <nop,nop,timestamp 102630 103035>
13:28:25.055032 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 3701:3801(100) ack 1 win 2920 <nop,nop,timestamp 103046 102629>
13:28:25.063241 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 2801 win 4696 <nop,nop,timestamp 102631 103036>
13:28:25.067666 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 3801:3901(100) ack 1 win 2920 <nop,nop,timestamp 103048 102631>
13:28:25.074267 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 2901 win 4696 <nop,nop,timestamp 102632 103037>
13:28:25.081869 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 3901:4001(100) ack 1 win 2920 <nop,nop,timestamp 103049 102632>
13:28:25.084879 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 4001:4101(100) ack 1 win 2920 <nop,nop,timestamp 103049 102632>
13:28:25.122535 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 3301 win 5596 <nop,nop,timestamp 102637 103041>
13:28:25.122562 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 3401 win 5596 <nop,nop,timestamp 102637 103043>
13:28:25.122984 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 4101:4201(100) ack 1 win 2920 <nop,nop,timestamp 103052 102637>
13:28:25.128033 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 4201:4301(100) ack 1 win 2920 <nop,nop,timestamp 103054 102637>
13:28:25.135084 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 4301:4401(100) ack 1 win 2920 <nop,nop,timestamp 103054 102637>
13:28:25.140359 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 3501 win 5596 <nop,nop,timestamp 102638 103043>
13:28:25.140389 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 3601 win 5596 <nop,nop,timestamp 102639 103045>
13:28:25.147546 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 4401:4501(100) ack 1 win 2920 <nop,nop,timestamp 103056 102639>
13:28:25.153049 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 3701 win 5596 <nop,nop,timestamp 102640 103046>
13:28:25.160786 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 4501:4601(100) ack 1 win 2920 <nop,nop,timestamp 103057 102640>
13:28:25.163869 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 3801 win 5596 <nop,nop,timestamp 102641 103046>
13:28:25.168319 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 4601:4701(100) ack 1 win 2920 <nop,nop,timestamp 103058 102641>
13:28:25.174619 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 3901 win 5596 <nop,nop,timestamp 102642 103048>
13:28:25.175044 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 4701:4801(100) ack 1 win 2920 <nop,nop,timestamp 103058 102642>
13:28:25.182494 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 4001 win 5596 <nop,nop,timestamp 102643 103049>
13:28:25.187736 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 4801:4901(100) ack 1 win 2920 <nop,nop,timestamp 103060 102643>
13:28:25.193108 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 4101 win 5596 <nop,nop,timestamp 102644 103049>
13:28:25.200663 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    P 4901:5001(100) ack 1 win 2920 <nop,nop,timestamp 103061 102644>
13:28:25.205701 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    F 5001:5001(0) ack 1 win 2920 <nop,nop,timestamp 103061 102644>
13:28:25.232522 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 4201 win 5596 <nop,nop,timestamp 102648 103052>
13:28:25.232549 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 4301 win 5596 <nop,nop,timestamp 102648 103054>
13:28:25.242489 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 4401 win 5596 <nop,nop,timestamp 102648 103054>
13:28:25.252534 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 4501 win 5596 <nop,nop,timestamp 102650 103056>
13:28:25.262483 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 4601 win 5596 <nop,nop,timestamp 102651 103057>
13:28:25.272502 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 4701 win 5596 <nop,nop,timestamp 102652 103058>
13:28:25.282474 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 4801 win 5596 <nop,nop,timestamp 102653 103058>
13:28:25.292418 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 4901 win 5596 <nop,nop,timestamp 102654 103060>
13:28:25.302535 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    . ack 5001 win 5596 <nop,nop,timestamp 102655 103061>
13:28:25.312492 IP 10.40.0.2.9 > 10.10.0.2.38351: 
    F 1:1(0) ack 5002 win 5596 <nop,nop,timestamp 102656 103061>
13:28:25.312942 IP 10.10.0.2.38351 > 10.40.0.2.9: 
    . ack 2 win 2920 <nop,nop,timestamp 103072 102656>
\end{Verbatim}

На машине с1 запускаем ./nagle nodelay 10.40.0.2 9 1 100.

Дамп на с2:
\begin{Verbatim}
c2:~# tcpdump -n -i eth0 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
13:29:38.692739 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    S 1946719347:1946719347(0) win 5840 
        <mss 1460,sackOK,timestamp 110407 0,nop,wscale 1>
13:29:38.802583 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    S 1948956427:1948956427(0) ack 1946719348 win 5792 
        <mss 1460,sackOK,timestamp 110005 110407,nop,wscale 1>
13:29:38.803058 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    . ack 1 win 2920 <nop,nop,timestamp 110420 110005>
13:29:38.803277 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 1:101(100) ack 1 win 2920 <nop,nop,timestamp 110420 110005>
13:29:38.805285 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 101:201(100) ack 1 win 2920 <nop,nop,timestamp 110421 110005>
13:29:38.814752 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 201:301(100) ack 1 win 2920 <nop,nop,timestamp 110422 110005>
13:29:38.912463 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 101 win 2896 <nop,nop,timestamp 110016 110420>
13:29:38.912492 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 201 win 2896 <nop,nop,timestamp 110016 110421>
13:29:38.912866 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 301:1201(900) ack 1 win 2920 <nop,nop,timestamp 110431 110016>
13:29:38.917586 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 1201:1301(100) ack 1 win 2920 <nop,nop,timestamp 110433 110016>
13:29:38.923963 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 301 win 2896 <nop,nop,timestamp 110016 110422>
13:29:38.931830 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 1301:1401(100) ack 1 win 2920 <nop,nop,timestamp 110434 110016>
13:29:38.935162 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 1401:1501(100) ack 1 win 2920 <nop,nop,timestamp 110434 110016>
13:29:38.944818 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 1501:1601(100) ack 1 win 2920 <nop,nop,timestamp 110435 110016>
13:29:38.955103 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 1601:1701(100) ack 1 win 2920 <nop,nop,timestamp 110436 110016>
13:29:39.022696 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 1201 win 3796 <nop,nop,timestamp 110027 110431>
13:29:39.022727 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 1301 win 3796 <nop,nop,timestamp 110027 110433>
13:29:39.023222 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 1701:2301(600) ack 1 win 2920 <nop,nop,timestamp 110442 110027>
13:29:39.027689 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 2301:2401(100) ack 1 win 2920 <nop,nop,timestamp 110444 110027>
13:29:39.033291 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 1401 win 3796 <nop,nop,timestamp 110028 110434>
13:29:39.041094 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 2401:2501(100) ack 1 win 2920 <nop,nop,timestamp 110445 110028>
13:29:39.044363 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 1501 win 3796 <nop,nop,timestamp 110029 110434>
13:29:39.048729 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 2501:2601(100) ack 1 win 2920 <nop,nop,timestamp 110446 110029>
13:29:39.055069 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 2601:2701(100) ack 1 win 2920 <nop,nop,timestamp 110446 110029>
13:29:39.055264 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 1601 win 3796 <nop,nop,timestamp 110030 110435>
13:29:39.062456 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 1701 win 3796 <nop,nop,timestamp 110031 110436>
13:29:39.067993 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 2701:2801(100) ack 1 win 2920 <nop,nop,timestamp 110448 110031>
13:29:39.075046 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 2801:2901(100) ack 1 win 2920 <nop,nop,timestamp 110448 110031>
13:29:39.084726 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 2901:3001(100) ack 1 win 2920 <nop,nop,timestamp 110449 110031>
13:29:39.095156 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 3001:3101(100) ack 1 win 2920 <nop,nop,timestamp 110450 110031>
13:29:39.132583 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 2301 win 4696 <nop,nop,timestamp 110038 110442>
13:29:39.132616 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 2401 win 4696 <nop,nop,timestamp 110038 110444>
13:29:39.133082 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 3101:3201(100) ack 1 win 2920 <nop,nop,timestamp 110453 110038>
13:29:39.137958 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 3201:3301(100) ack 1 win 2920 <nop,nop,timestamp 110455 110038>
13:29:39.144962 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 3301:3401(100) ack 1 win 2920 <nop,nop,timestamp 110455 110038>
13:29:39.150404 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 2501 win 4696 <nop,nop,timestamp 110039 110445>
13:29:39.150431 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 2601 win 4696 <nop,nop,timestamp 110040 110446>
13:29:39.157869 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 3401:3501(100) ack 1 win 2920 <nop,nop,timestamp 110457 110040>
13:29:39.163539 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 2701 win 4696 <nop,nop,timestamp 110041 110446>
13:29:39.171090 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 3501:3601(100) ack 1 win 2920 <nop,nop,timestamp 110458 110041>
13:29:39.174592 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 2801 win 4696 <nop,nop,timestamp 110042 110448>
13:29:39.174976 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 3601:3701(100) ack 1 win 2920 <nop,nop,timestamp 110458 110042>
13:29:39.183358 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 2901 win 4696 <nop,nop,timestamp 110043 110448>
13:29:39.187358 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 3701:3801(100) ack 1 win 2920 <nop,nop,timestamp 110460 110043>
13:29:39.194260 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 3001 win 4696 <nop,nop,timestamp 110044 110449>
13:29:39.202237 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 3801:3901(100) ack 1 win 2920 <nop,nop,timestamp 110461 110044>
13:29:39.202343 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 3101 win 4696 <nop,nop,timestamp 110045 110450>
13:29:39.205299 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 3901:4001(100) ack 1 win 2920 <nop,nop,timestamp 110461 110045>
13:29:39.214603 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 4001:4101(100) ack 1 win 2920 <nop,nop,timestamp 110462 110045>
13:29:39.224867 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 4101:4201(100) ack 1 win 2920 <nop,nop,timestamp 110463 110045>
13:29:39.234880 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 4201:4301(100) ack 1 win 2920 <nop,nop,timestamp 110464 110045>
13:29:39.242522 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 3201 win 4696 <nop,nop,timestamp 110049 110453>
13:29:39.242549 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 3301 win 4696 <nop,nop,timestamp 110049 110455>
13:29:39.248107 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 4301:4401(100) ack 1 win 2920 <nop,nop,timestamp 110466 110049>
13:29:39.254013 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 3401 win 4696 <nop,nop,timestamp 110049 110455>
13:29:39.261312 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 4401:4501(100) ack 1 win 2920 <nop,nop,timestamp 110467 110049>
13:29:39.265041 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 3501 win 4696 <nop,nop,timestamp 110051 110457>
13:29:39.265078 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 4501:4601(100) ack 1 win 2920 <nop,nop,timestamp 110467 110049>
13:29:39.273037 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 3601 win 4696 <nop,nop,timestamp 110052 110458>
13:29:39.282463 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 3701 win 4696 <nop,nop,timestamp 110053 110458>
13:29:39.292595 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 3801 win 4696 <nop,nop,timestamp 110054 110460>
13:29:39.292634 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 4601:4701(100) ack 1 win 2920 <nop,nop,timestamp 110470 110053>
13:29:39.295199 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 4701:4801(100) ack 1 win 2920 <nop,nop,timestamp 110470 110054>
13:29:39.304698 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 4801:4901(100) ack 1 win 2920 <nop,nop,timestamp 110471 110054>
13:29:39.309015 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 3901 win 4696 <nop,nop,timestamp 110056 110461>
13:29:39.309044 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 4001 win 4696 <nop,nop,timestamp 110056 110461>
13:29:39.318234 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 4901:5001(100) ack 1 win 2920 <nop,nop,timestamp 110473 110056>
13:29:39.322477 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 4101 win 4696 <nop,nop,timestamp 110057 110462>
13:29:39.329371 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 5001:5101(100) ack 1 win 2920 <nop,nop,timestamp 110474 110057>
13:29:39.334939 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 5101:5201(100) ack 1 win 2920 <nop,nop,timestamp 110474 110057>
13:29:39.342100 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 4201 win 4696 <nop,nop,timestamp 110058 110463>
13:29:39.342128 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 4301 win 4696 <nop,nop,timestamp 110059 110464>
13:29:39.346029 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 5201:5301(100) ack 1 win 2920 <nop,nop,timestamp 110475 110059>
13:29:39.352469 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 4401 win 4696 <nop,nop,timestamp 110060 110466>
13:29:39.357733 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 5301:5401(100) ack 1 win 2920 <nop,nop,timestamp 110477 110060>
13:29:39.362953 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 4501 win 4696 <nop,nop,timestamp 110061 110467>
13:29:39.370549 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 5401:5501(100) ack 1 win 2920 <nop,nop,timestamp 110478 110061>
13:29:39.374196 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 4601 win 4696 <nop,nop,timestamp 110062 110467>
13:29:39.379021 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 5501:5601(100) ack 1 win 2920 <nop,nop,timestamp 110479 110062>
13:29:39.385010 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 5601:5701(100) ack 1 win 2920 <nop,nop,timestamp 110479 110062>
13:29:39.395145 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 5701:5801(100) ack 1 win 2920 <nop,nop,timestamp 110480 110062>
13:29:39.404712 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 4701 win 4696 <nop,nop,timestamp 110065 110470>
13:29:39.404737 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 4801 win 4696 <nop,nop,timestamp 110065 110470>
13:29:39.405061 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 5801:5901(100) ack 1 win 2920 <nop,nop,timestamp 110481 110065>
13:29:39.412461 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 4901 win 4696 <nop,nop,timestamp 110065 110471>
13:29:39.417468 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 5901:6001(100) ack 1 win 2920 <nop,nop,timestamp 110483 110065>
13:29:39.422425 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 5001 win 4696 <nop,nop,timestamp 110067 110473>
13:29:39.430133 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 6001:6101(100) ack 1 win 2920 <nop,nop,timestamp 110484 110067>
13:29:39.433122 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 5101 win 4696 <nop,nop,timestamp 110068 110474>
13:29:39.438389 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 6101:6201(100) ack 1 win 2920 <nop,nop,timestamp 110485 110068>
13:29:39.444149 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 5201 win 4696 <nop,nop,timestamp 110068 110474>
13:29:39.451098 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 6201:6301(100) ack 1 win 2920 <nop,nop,timestamp 110486 110068>
13:29:39.454877 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 6301:6401(100) ack 1 win 2920 <nop,nop,timestamp 110486 110068>
13:29:39.455272 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 5301 win 4696 <nop,nop,timestamp 110070 110475>
13:29:39.462421 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 5401 win 4696 <nop,nop,timestamp 110071 110477>
13:29:39.467210 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 6401:6501(100) ack 1 win 2920 <nop,nop,timestamp 110488 110071>
13:29:39.475012 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 6501:6601(100) ack 1 win 2920 <nop,nop,timestamp 110488 110071>
13:29:39.475143 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 5501 win 4696 <nop,nop,timestamp 110072 110478>
13:29:39.482484 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 5601 win 4696 <nop,nop,timestamp 110073 110479>
13:29:39.487762 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 6601:6701(100) ack 1 win 2920 <nop,nop,timestamp 110490 110073>
13:29:39.493350 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 5701 win 4696 <nop,nop,timestamp 110074 110479>
13:29:39.500865 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 6701:6801(100) ack 1 win 2920 <nop,nop,timestamp 110491 110074>
13:29:39.504183 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 5801 win 4696 <nop,nop,timestamp 110075 110480>
13:29:39.508509 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 6801:6901(100) ack 1 win 2920 <nop,nop,timestamp 110492 110075>
13:29:39.514943 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 6901:7001(100) ack 1 win 2920 <nop,nop,timestamp 110492 110075>
13:29:39.514977 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 5901 win 4696 <nop,nop,timestamp 110076 110481>
13:29:39.522495 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 6001 win 4696 <nop,nop,timestamp 110077 110483>
13:29:39.528073 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 7001:7101(100) ack 1 win 2920 <nop,nop,timestamp 110494 110077>
13:29:39.534341 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 6101 win 4696 <nop,nop,timestamp 110078 110484>
13:29:39.541454 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 7101:7201(100) ack 1 win 2920 <nop,nop,timestamp 110495 110078>
13:29:39.544924 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 7201:7301(100) ack 1 win 2920 <nop,nop,timestamp 110495 110078>
13:29:39.545010 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 6201 win 4696 <nop,nop,timestamp 110079 110485>
13:29:39.552868 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 6301 win 4696 <nop,nop,timestamp 110080 110486>
13:29:39.558271 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 7301:7401(100) ack 1 win 2920 <nop,nop,timestamp 110497 110080>
13:29:39.565068 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 7401:7501(100) ack 1 win 2920 <nop,nop,timestamp 110497 110080>
13:29:39.565237 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 6401 win 4696 <nop,nop,timestamp 110081 110486>
13:29:39.572478 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 6501 win 4696 <nop,nop,timestamp 110082 110488>
13:29:39.578051 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 7501:7601(100) ack 1 win 2920 <nop,nop,timestamp 110499 110082>
13:29:39.584631 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 6601 win 4696 <nop,nop,timestamp 110083 110488>
13:29:39.584855 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 7601:7701(100) ack 1 win 2920 <nop,nop,timestamp 110499 110082>
13:29:39.592433 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 6701 win 4696 <nop,nop,timestamp 110084 110490>
13:29:39.597861 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 7701:7801(100) ack 1 win 2920 <nop,nop,timestamp 110501 110084>
13:29:39.603343 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 6801 win 4696 <nop,nop,timestamp 110085 110491>
13:29:39.610777 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 7801:7901(100) ack 1 win 2920 <nop,nop,timestamp 110502 110085>
13:29:39.614336 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 6901 win 4696 <nop,nop,timestamp 110086 110492>
13:29:39.618688 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 7901:8001(100) ack 1 win 2920 <nop,nop,timestamp 110503 110086>
13:29:39.625044 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 8001:8101(100) ack 1 win 2920 <nop,nop,timestamp 110503 110086>
13:29:39.625090 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 7001 win 4696 <nop,nop,timestamp 110087 110492>
13:29:39.632459 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 7101 win 4696 <nop,nop,timestamp 110088 110494>
13:29:39.637738 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 8101:8201(100) ack 1 win 2920 <nop,nop,timestamp 110505 110088>
13:29:39.644757 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 7201 win 4696 <nop,nop,timestamp 110089 110495>
13:29:39.644978 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 8201:8301(100) ack 1 win 2920 <nop,nop,timestamp 110505 110088>
13:29:39.652473 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 7301 win 4696 <nop,nop,timestamp 110090 110495>
13:29:39.657314 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 8301:8401(100) ack 1 win 2920 <nop,nop,timestamp 110507 110090>
13:29:39.663039 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 7401 win 4696 <nop,nop,timestamp 110091 110497>
13:29:39.671004 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 8401:8501(100) ack 1 win 2920 <nop,nop,timestamp 110508 110091>
13:29:39.674040 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 7501 win 4696 <nop,nop,timestamp 110092 110497>
13:29:39.678481 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 8501:8601(100) ack 1 win 2920 <nop,nop,timestamp 110509 110092>
13:29:39.685006 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 8601:8701(100) ack 1 win 2920 <nop,nop,timestamp 110509 110092>
13:29:39.685042 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 7601 win 4696 <nop,nop,timestamp 110093 110499>
13:29:39.692464 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 7701 win 4696 <nop,nop,timestamp 110094 110499>
13:29:39.697837 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 8701:8801(100) ack 1 win 2920 <nop,nop,timestamp 110511 110094>
13:29:39.704471 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 7801 win 4696 <nop,nop,timestamp 110095 110501>
13:29:39.711985 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 8801:8901(100) ack 1 win 2920 <nop,nop,timestamp 110512 110095>
13:29:39.715009 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 8901:9001(100) ack 1 win 2920 <nop,nop,timestamp 110512 110095>
13:29:39.718478 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 7901 win 4696 <nop,nop,timestamp 110096 110502>
13:29:39.722423 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 8001 win 4696 <nop,nop,timestamp 110097 110503>
13:29:39.730163 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 9001:9101(100) ack 1 win 2920 <nop,nop,timestamp 110514 110097>
13:29:39.733528 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 8101 win 4696 <nop,nop,timestamp 110098 110503>
13:29:39.738611 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 9101:9201(100) ack 1 win 2920 <nop,nop,timestamp 110515 110098>
13:29:39.744126 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 8201 win 4696 <nop,nop,timestamp 110099 110505>
13:29:39.750924 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 9201:9301(100) ack 1 win 2920 <nop,nop,timestamp 110516 110099>
13:29:39.755077 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 9301:9401(100) ack 1 win 2920 <nop,nop,timestamp 110516 110099>
13:29:39.755111 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 8301 win 4696 <nop,nop,timestamp 110100 110505>
13:29:39.763016 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 8401 win 4696 <nop,nop,timestamp 110101 110507>
13:29:39.766595 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 9401:9501(100) ack 1 win 2920 <nop,nop,timestamp 110518 110101>
13:29:39.774667 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 8501 win 4696 <nop,nop,timestamp 110102 110508>
13:29:39.774885 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 9501:9601(100) ack 1 win 2920 <nop,nop,timestamp 110518 110101>
13:29:39.782566 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 8601 win 4696 <nop,nop,timestamp 110103 110509>
13:29:39.787913 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 9601:9701(100) ack 1 win 2920 <nop,nop,timestamp 110520 110103>
13:29:39.792852 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 8701 win 4696 <nop,nop,timestamp 110104 110509>
13:29:39.800407 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 9701:9801(100) ack 1 win 2920 <nop,nop,timestamp 110521 110104>
13:29:39.803870 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 8801 win 4696 <nop,nop,timestamp 110105 110511>
13:29:39.808769 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 9801:9901(100) ack 1 win 2920 <nop,nop,timestamp 110522 110105>
13:29:39.814667 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 8901 win 4696 <nop,nop,timestamp 110106 110512>
13:29:39.814799 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    P 9901:10001(100) ack 1 win 2920 <nop,nop,timestamp 110522 110105>
13:29:39.822435 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 9001 win 4696 <nop,nop,timestamp 110106 110512>
13:29:39.828528 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    F 10001:10001(0) ack 1 win 2920 <nop,nop,timestamp 110524 110106>
13:29:39.838247 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 9101 win 4696 <nop,nop,timestamp 110108 110514>
13:29:39.842338 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 9201 win 4696 <nop,nop,timestamp 110109 110515>
13:29:39.852525 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 9301 win 4696 <nop,nop,timestamp 110110 110516>
13:29:39.862480 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 9401 win 4696 <nop,nop,timestamp 110111 110516>
13:29:39.872512 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 9501 win 4696 <nop,nop,timestamp 110112 110518>
13:29:39.882456 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 9601 win 4696 <nop,nop,timestamp 110113 110518>
13:29:39.892468 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 9701 win 4696 <nop,nop,timestamp 110114 110520>
13:29:39.902427 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 9801 win 4696 <nop,nop,timestamp 110115 110521>
13:29:39.912556 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 9901 win 4696 <nop,nop,timestamp 110116 110522>
13:29:39.922372 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    . ack 10001 win 4696 <nop,nop,timestamp 110117 110522>
13:29:39.942574 IP 10.40.0.2.9 > 10.10.0.2.38352: 
    F 1:1(0) ack 10002 win 4696 <nop,nop,timestamp 110118 110524>
13:29:39.942888 IP 10.10.0.2.38352 > 10.40.0.2.9: 
    . ack 2 win 2920 <nop,nop,timestamp 110534 110118>
\end{Verbatim}

\section{Нейгл и Мишналь}

На машине с1 запускаем ./nagle default 10.40.0.2 9 0 30.

Дамп на с2:
\begin{Verbatim}
c2:~# tcpdump -n -i eth0 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
13:42:57.248208 IP 10.10.0.2.47134 > 10.40.0.2.9: 
    S 1485787614:1485787614(0) win 5840 
        <mss 1460,sackOK,timestamp 16289 0,nop,wscale 1>
13:42:57.448756 IP 10.40.0.2.9 > 10.10.0.2.47134: 
    S 1496950408:1496950408(0) ack 1485787615 win 5792 
        <mss 1460,sackOK,timestamp 15976 16289,nop,wscale 1>
13:42:57.449178 IP 10.10.0.2.47134 > 10.40.0.2.9: 
    . ack 1 win 2920 <nop,nop,timestamp 16312 15976>
13:42:57.449513 IP 10.10.0.2.47134 > 10.40.0.2.9: 
    P 1:101(100) ack 1 win 2920 <nop,nop,timestamp 16312 15976>
13:42:57.579085 IP 10.10.0.2.47134 > 10.40.0.2.9: 
    . 101:1549(1448) ack 1 win 2920 <nop,nop,timestamp 16325 15976>
13:42:57.658787 IP 10.40.0.2.9 > 10.10.0.2.47134: 
    . ack 101 win 2896 <nop,nop,timestamp 15997 16312>
13:42:57.659208 IP 10.10.0.2.47134 > 10.40.0.2.9: 
    P 1549:2401(852) ack 1 win 2920 <nop,nop,timestamp 16333 15997>
13:42:57.690482 IP 10.10.0.2.47134 > 10.40.0.2.9: 
    FP 2401:3001(600) ack 1 win 2920 <nop,nop,timestamp 16337 15997>
13:42:57.788771 IP 10.40.0.2.9 > 10.10.0.2.47134: 
    . ack 1549 win 4344 <nop,nop,timestamp 16010 16325>
13:42:57.868746 IP 10.40.0.2.9 > 10.10.0.2.47134: 
    . ack 2401 win 5792 <nop,nop,timestamp 16018 16333>
13:42:57.898728 IP 10.40.0.2.9 > 10.10.0.2.47134: 
    F 1:1(0) ack 3002 win 7240 <nop,nop,timestamp 16021 16337>
13:42:57.899119 IP 10.10.0.2.47134 > 10.40.0.2.9: 
    . ack 2 win 2920 <nop,nop,timestamp 16357 16021>
\end{Verbatim}

На машине с1 запускаем ./nagle default 10.40.0.2 9 3 30.

Дамп на с2:
\begin{Verbatim}
c2:~# tcpdump -n -i eth0 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
13:46:45.713680 IP 10.10.0.2.46403 > 10.40.0.2.9: 
    S 791489354:791489354(0) win 5840 
        <mss 1460,sackOK,timestamp 39136 0,nop,wscale 1>
13:46:45.922926 IP 10.40.0.2.9 > 10.10.0.2.46403: 
    S 777743416:777743416(0) ack 791489355 win 5792 
        <mss 1460,sackOK,timestamp 38823 39136,nop,wscale 1>
13:46:45.923366 IP 10.10.0.2.46403 > 10.40.0.2.9: 
    . ack 1 win 2920 <nop,nop,timestamp 39159 38823>
13:46:45.923603 IP 10.10.0.2.46403 > 10.40.0.2.9: 
    P 1:101(100) ack 1 win 2920 <nop,nop,timestamp 39159 38823>
13:46:46.069113 IP 10.10.0.2.46403 > 10.40.0.2.9: 
    . 101:1549(1448) ack 1 win 2920 <nop,nop,timestamp 39174 38823>
13:46:46.128793 IP 10.40.0.2.9 > 10.10.0.2.46403: 
    . ack 101 win 2896 <nop,nop,timestamp 38844 39159>
13:46:46.129241 IP 10.10.0.2.46403 > 10.40.0.2.9: 
    P 1549:2201(652) ack 1 win 2920 <nop,nop,timestamp 39180 38844>
13:46:46.219930 IP 10.10.0.2.46403 > 10.40.0.2.9: 
    FP 2201:3001(800) ack 1 win 2920 <nop,nop,timestamp 39189 38844>
13:46:46.278676 IP 10.40.0.2.9 > 10.10.0.2.46403: 
    . ack 1549 win 4344 <nop,nop,timestamp 38859 39174>
13:46:46.338731 IP 10.40.0.2.9 > 10.10.0.2.46403: 
    . ack 2201 win 5792 <nop,nop,timestamp 38865 39180>
13:46:46.428770 IP 10.40.0.2.9 > 10.10.0.2.46403: 
    F 1:1(0) ack 3002 win 7240 <nop,nop,timestamp 38874 39189>
13:46:46.429229 IP 10.10.0.2.46403 > 10.40.0.2.9: 
    . ack 2 win 2920 <nop,nop,timestamp 39210 38874>
\end{Verbatim}

\section{Аггрессивная буферизация}

На машине с1 запускаем ./nagle cork 10.40.0.2 9 400 30.

Дамп на с2:
\begin{Verbatim}
c2:~# tcpdump -n -i eth0 tcpp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
13:48:00.875505 IP 10.10.0.2.46404 > 10.40.0.2.9: 
    S 1966828468:1966828468(0) win 5840 
        <mss 1460,sackOK,timestamp 46655 0,nop,wscale 1>
13:48:01.078766 IP 10.40.0.2.9 > 10.10.0.2.46404: 
    S 1956188857:1956188857(0) ack 1966828469 win 5792 
        <mss 1460,sackOK,timestamp 46339 46655,nop,wscale 1>
13:48:01.079159 IP 10.10.0.2.46404 > 10.40.0.2.9: 
    . ack 1 win 2920 <nop,nop,timestamp 46675 46339>
13:48:02.188612 IP 10.10.0.2.46404 > 10.40.0.2.9: 
    P 1:301(300) ack 1 win 2920 <nop,nop,timestamp 46786 46339>
13:48:02.398751 IP 10.40.0.2.9 > 10.10.0.2.46404: 
    . ack 301 win 3432 <nop,nop,timestamp 46471 46786>
13:48:03.508672 IP 10.10.0.2.46404 > 10.40.0.2.9: 
    P 301:601(300) ack 1 win 2920 <nop,nop,timestamp 46918 46471>
13:48:03.718801 IP 10.40.0.2.9 > 10.10.0.2.46404: 
    . ack 601 win 3968 <nop,nop,timestamp 46603 46918>
13:48:04.738600 IP 10.10.0.2.46404 > 10.40.0.2.9: 
    P 601:901(300) ack 1 win 2920 <nop,nop,timestamp 47041 46603>
13:48:04.948595 IP 10.40.0.2.9 > 10.10.0.2.46404: 
    . ack 901 win 4504 <nop,nop,timestamp 46726 47041>
13:48:05.868546 IP 10.10.0.2.46404 > 10.40.0.2.9: 
    P 901:1201(300) ack 1 win 2920 <nop,nop,timestamp 47154 46726>
13:48:06.078873 IP 10.40.0.2.9 > 10.10.0.2.46404: 
    . ack 1201 win 4504 <nop,nop,timestamp 46839 47154>
13:48:06.888524 IP 10.10.0.2.46404 > 10.40.0.2.9: 
    P 1201:1501(300) ack 1 win 2920 <nop,nop,timestamp 47256 46839>
13:48:07.098737 IP 10.40.0.2.9 > 10.10.0.2.46404: 
    . ack 1501 win 4504 <nop,nop,timestamp 46941 47256>
13:48:07.958519 IP 10.10.0.2.46404 > 10.40.0.2.9: 
    P 1501:1701(200) ack 1 win 2920 <nop,nop,timestamp 47363 46941>
13:48:08.168789 IP 10.40.0.2.9 > 10.10.0.2.46404: 
    . ack 1701 win 4504 <nop,nop,timestamp 47048 47363>
13:48:08.818461 IP 10.10.0.2.46404 > 10.40.0.2.9: 
    P 1701:1901(200) ack 1 win 2920 <nop,nop,timestamp 47449 47048>
13:48:09.028795 IP 10.40.0.2.9 > 10.10.0.2.46404: 
    . ack 1901 win 4504 <nop,nop,timestamp 47134 47449>
13:48:09.618633 IP 10.10.0.2.46404 > 10.40.0.2.9: 
    P 1901:2101(200) ack 1 win 2920 <nop,nop,timestamp 47529 47134>
13:48:09.828759 IP 10.40.0.2.9 > 10.10.0.2.46404: 
    . ack 2101 win 4504 <nop,nop,timestamp 47214 47529>
13:48:10.378560 IP 10.10.0.2.46404 > 10.40.0.2.9: 
    P 2101:2301(200) ack 1 win 2920 <nop,nop,timestamp 47605 47214>
13:48:10.588735 IP 10.40.0.2.9 > 10.10.0.2.46404: 
    . ack 2301 win 4504 <nop,nop,timestamp 47290 47605>
13:48:11.108353 IP 10.10.0.2.46404 > 10.40.0.2.9: 
    P 2301:2501(200) ack 1 win 2920 <nop,nop,timestamp 47678 47290>
13:48:11.308618 IP 10.40.0.2.9 > 10.10.0.2.46404: 
    . ack 2501 win 4504 <nop,nop,timestamp 47363 47678>
13:48:11.818471 IP 10.10.0.2.46404 > 10.40.0.2.9: 
    P 2501:2701(200) ack 1 win 2920 <nop,nop,timestamp 47749 47363>
13:48:12.028703 IP 10.40.0.2.9 > 10.10.0.2.46404: 
    . ack 2701 win 4504 <nop,nop,timestamp 47434 47749>
13:48:12.618349 IP 10.10.0.2.46404 > 10.40.0.2.9: 
    P 2701:2901(200) ack 1 win 2920 <nop,nop,timestamp 47829 47434>
13:48:12.828799 IP 10.40.0.2.9 > 10.10.0.2.46404: 
    . ack 2901 win 4504 <nop,nop,timestamp 47514 47829>
13:48:13.369813 IP 10.10.0.2.46404 > 10.40.0.2.9: 
    FP 2901:3001(100) ack 1 win 2920 <nop,nop,timestamp 47904 47514>
13:48:13.578792 IP 10.40.0.2.9 > 10.10.0.2.46404: 
    F 1:1(0) ack 3002 win 4504 <nop,nop,timestamp 47589 47904>
13:48:13.579122 IP 10.10.0.2.46404 > 10.40.0.2.9: 
    . ack 2 win 2920 <nop,nop,timestamp 47925 47589>
\end{Verbatim}

\section{Отправка без задержки}


На машине с1 запускаем ./nagle nodelay 10.40.0.2 9 0 30.

Дамп на с2:
\begin{Verbatim}
l
c2:~# tcpdump -n -i eth0 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
13:49:18.234555 IP 10.10.0.2.46405 > 10.40.0.2.9: 
    S 3167168889:3167168889(0) win 5840 
        <mss 1460,sackOK,timestamp 54389 0,nop,wscale 1>
13:49:18.438726 IP 10.40.0.2.9 > 10.10.0.2.46405: 
    S 3167992418:3167992418(0) ack 3167168890 win 5792 
        <mss 1460,sackOK,timestamp 54075 54389,nop,wscale 1>
13:49:18.439119 IP 10.10.0.2.46405 > 10.40.0.2.9: 
    . ack 1 win 2920 <nop,nop,timestamp 54411 54075>
13:49:18.439373 IP 10.10.0.2.46405 > 10.40.0.2.9: 
    P 1:101(100) ack 1 win 2920 <nop,nop,timestamp 54411 54075>
13:49:18.449230 IP 10.10.0.2.46405 > 10.40.0.2.9: 
    P 101:201(100) ack 1 win 2920 <nop,nop,timestamp 54413 54075>
13:49:18.449423 IP 10.10.0.2.46405 > 10.40.0.2.9: 
    P 201:301(100) ack 1 win 2920 <nop,nop,timestamp 54413 54075>
13:49:18.648771 IP 10.40.0.2.9 > 10.10.0.2.46405: 
    . ack 101 win 2896 <nop,nop,timestamp 54096 54411>
13:49:18.649230 IP 10.10.0.2.46405 > 10.40.0.2.9: 
    . 301:1749(1448) ack 1 win 2920 <nop,nop,timestamp 54432 54096>
13:49:18.649263 IP 10.10.0.2.46405 > 10.40.0.2.9: 
    FP 1749:3001(1252) ack 1 win 2920 <nop,nop,timestamp 54432 54096>
13:49:18.663626 IP 10.40.0.2.9 > 10.10.0.2.46405: 
    . ack 201 win 2896 <nop,nop,timestamp 54096 54413>
13:49:18.663652 IP 10.40.0.2.9 > 10.10.0.2.46405: 
    . ack 301 win 2896 <nop,nop,timestamp 54096 54413>
13:49:18.858735 IP 10.40.0.2.9 > 10.10.0.2.46405: 
    . ack 1749 win 4344 <nop,nop,timestamp 54117 54432>
13:49:18.858765 IP 10.40.0.2.9 > 10.10.0.2.46405: 
    F 1:1(0) ack 3002 win 5792 <nop,nop,timestamp 54117 54432>
13:49:18.859162 IP 10.10.0.2.46405 > 10.40.0.2.9: 
    . ack 2 win 2920 <nop,nop,timestamp 54453 54117>
\end{Verbatim}

На машине с1 запускаем ./nagle nodelay 10.40.0.2 9 -1 30.

Дамп на с2:
\begin{Verbatim}
c2:~# tcpdump -n -i eth0 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
13:50:22.365221 IP 10.10.0.2.55948 > 10.40.0.2.9: 
    S 4186774095:4186774095(0) win 5840 
        <mss 1460,sackOK,timestamp 60801 0,nop,wscale 1>
13:50:22.568788 IP 10.40.0.2.9 > 10.10.0.2.55948: 
    S 4192565890:4192565890(0) ack 4186774096 win 5792 
        <mss 1460,sackOK,timestamp 60488 60801,nop,wscale 1>
13:50:22.569200 IP 10.10.0.2.55948 > 10.40.0.2.9: 
    . ack 1 win 2920 <nop,nop,timestamp 60824 60488>
13:50:22.569565 IP 10.10.0.2.55948 > 10.40.0.2.9: 
    P 1:101(100) ack 1 win 2920 <nop,nop,timestamp 60824 60488>
13:50:22.569788 IP 10.10.0.2.55948 > 10.40.0.2.9: 
    P 101:201(100) ack 1 win 2920 <nop,nop,timestamp 60824 60488>
13:50:22.569999 IP 10.10.0.2.55948 > 10.40.0.2.9: 
    P 201:301(100) ack 1 win 2920 <nop,nop,timestamp 60824 60488>
13:50:22.778711 IP 10.40.0.2.9 > 10.10.0.2.55948: 
    . ack 101 win 2896 <nop,nop,timestamp 60509 60824>
13:50:22.778731 IP 10.40.0.2.9 > 10.10.0.2.55948: 
    . ack 201 win 2896 <nop,nop,timestamp 60509 60824>
13:50:22.778739 IP 10.40.0.2.9 > 10.10.0.2.55948: 
    . ack 301 win 2896 <nop,nop,timestamp 60509 60824>
13:50:22.779133 IP 10.10.0.2.55948 > 10.40.0.2.9: 
    . 301:1749(1448) ack 1 win 2920 <nop,nop,timestamp 60845 60509>
13:50:22.779154 IP 10.10.0.2.55948 > 10.40.0.2.9: 
    FP 1749:3001(1252) ack 1 win 2920 <nop,nop,timestamp 60845 60509>
13:50:22.988780 IP 10.40.0.2.9 > 10.10.0.2.55948: 
    . ack 1749 win 4344 <nop,nop,timestamp 60530 60845>
13:50:22.988803 IP 10.40.0.2.9 > 10.10.0.2.55948: 
    F 1:1(0) ack 3002 win 5792 <nop,nop,timestamp 60530 60845>
13:50:22.989087 IP 10.10.0.2.55948 > 10.40.0.2.9: 
    . ack 2 win 2920 <nop,nop,timestamp 60866 60530>
\end{Verbatim}

\section{Быстрый повтор}

На с1 запускаем:
\begin{Verbatim}
tcpdump -n -i eth0  tcp >> tcpdump1.txt &
./nagle nodelay 10.30.0.2 9 1 30
\end{Verbatim}

Содержимое файла tcpdump1.txt
\begin{Verbatim}
c1:~# cat ./tcpdump1.txt 
15:20:01.994878 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    S 2590168269:2590168269(0) win 5840 
        <mss 1460,sackOK,timestamp 598766 0,nop,wscale 1>
15:20:01.996319 IP 10.30.0.2.9 > 10.10.0.2.49547: 
    S 2624393908:2624393908(0) ack 2590168270 win 2096 
        <mss 536,sackOK,timestamp 598452 598766,nop,wscale 1>
15:20:01.996355 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    . ack 1 win 2920 <nop,nop,timestamp 598766 598452>
15:20:01.997329 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    P 1:101(100) ack 1 win 2920 <nop,nop,timestamp 598766 598452>
15:20:01.998096 IP 10.30.0.2.9 > 10.10.0.2.49547: 
    . ack 101 win 1048 <nop,nop,timestamp 598452 598766>
15:20:02.008131 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    P 101:201(100) ack 1 win 2920 <nop,nop,timestamp 598768 598452>
15:20:02.008907 IP 10.30.0.2.9 > 10.10.0.2.49547: 
    . ack 201 win 1048 <nop,nop,timestamp 598452 598768>
15:20:02.014921 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    P 201:301(100) ack 1 win 2920 <nop,nop,timestamp 598768 598452>
15:20:02.015778 IP 10.30.0.2.9 > 10.10.0.2.49547: 
    . ack 301 win 1048 <nop,nop,timestamp 598452 598768>
15:20:02.025072 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    P 301:401(100) ack 1 win 2920 <nop,nop,timestamp 598769 598452>
15:20:02.035153 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    P 401:501(100) ack 1 win 2920 <nop,nop,timestamp 598770 598452>
15:20:02.036522 IP 10.30.0.2.9 > 10.10.0.2.49547: 
    . ack 301 win 1048 <nop,nop,timestamp 598456 598768,nop,nop,sack 1 {401:501}>
15:20:02.046675 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    P 501:601(100) ack 1 win 2920 <nop,nop,timestamp 598772 598456>
15:20:02.047988 IP 10.30.0.2.9 > 10.10.0.2.49547: 
    . ack 301 win 1048 <nop,nop,timestamp 598458 598768,nop,nop,sack 1 {401:601}>
15:20:02.055189 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    P 601:701(100) ack 1 win 2920 <nop,nop,timestamp 598772 598458>
15:20:02.056204 IP 10.30.0.2.9 > 10.10.0.2.49547: 
    . ack 301 win 1048 <nop,nop,timestamp 598459 598768,nop,nop,sack 1 {401:701}>
15:20:02.056234 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    P 301:401(100) ack 1 win 2920 <nop,nop,timestamp 598772 598459>
15:20:02.057430 IP 10.30.0.2.9 > 10.10.0.2.49547: 
    . ack 701 win 1048 <nop,nop,timestamp 598459 598772>
15:20:02.067494 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    P 701:801(100) ack 1 win 2920 <nop,nop,timestamp 598774 598459>
15:20:02.324761 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    P 701:801(100) ack 1 win 2920 <nop,nop,timestamp 598799 598459>
15:20:02.326061 IP 10.30.0.2.9 > 10.10.0.2.49547: 
    . ack 801 win 1048 <nop,nop,timestamp 598485 598799,nop,nop,sack 1 {701:801}>
15:20:02.326096 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    . 801:1325(524) ack 1 win 2920 <nop,nop,timestamp 598799 598485>
15:20:02.326118 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    . 1325:1849(524) ack 1 win 2920 <nop,nop,timestamp 598799 598485>
15:20:02.327557 IP 10.30.0.2.9 > 10.10.0.2.49547: 
    . ack 1325 win 1572 <nop,nop,timestamp 598485 598799>
15:20:02.327589 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    . 1849:2373(524) ack 1 win 2920 <nop,nop,timestamp 598799 598485>
15:20:02.327615 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    . 2373:2897(524) ack 1 win 2920 <nop,nop,timestamp 598799 598485>
15:20:02.327626 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    FP 2897:3001(104) ack 1 win 2920 <nop,nop,timestamp 598799 598485>
15:20:02.327636 IP 10.30.0.2.9 > 10.10.0.2.49547: 
    . ack 1849 win 2096 <nop,nop,timestamp 598485 598799>
15:20:02.328832 IP 10.30.0.2.9 > 10.10.0.2.49547: 
    . ack 2897 win 3144 <nop,nop,timestamp 598485 598799>
15:20:02.332194 IP 10.30.0.2.9 > 10.10.0.2.49547: 
    F 1:1(0) ack 3002 win 3144 <nop,nop,timestamp 598485 598799>
15:20:02.332218 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    . ack 2 win 2920 <nop,nop,timestamp 598799 598485>
\end{Verbatim}

Дамп на с3 на eth1 можно увидеть, что теряются пакеты.

\begin{Verbatim}
c3:~# /etc/drop 10          
I will drop every 10 packet (counting from 1).
c3:~# tcpdump -n -i eth1 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth1, link-type EN10MB (Ethernet), capture size 96 bytes
15:20:01.990706 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    S 2590168269:2590168269(0) win 5840 
        <mss 536,sackOK,timestamp 598766 0,nop,wscale 1>
15:20:01.991183 IP 10.30.0.2.9 > 10.10.0.2.49547: 
    S 2624393908:2624393908(0) ack 2590168270 win 2096 
        <mss 536,sackOK,timestamp 598452 598766,nop,wscale 1>
15:20:01.992034 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    . ack 1 win 2920 <nop,nop,timestamp 598766 598452>
15:20:01.992903 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    P 1:101(100) ack 1 win 2920 <nop,nop,timestamp 598766 598452>
15:20:01.993184 IP 10.30.0.2.9 > 10.10.0.2.49547: 
    . ack 101 win 1048 <nop,nop,timestamp 598452 598766>
15:20:02.003660 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    P 101:201(100) ack 1 win 2920 <nop,nop,timestamp 598768 598452>
15:20:02.003963 IP 10.30.0.2.9 > 10.10.0.2.49547: 
    . ack 201 win 1048 <nop,nop,timestamp 598452 598768>
15:20:02.010548 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    P 201:301(100) ack 1 win 2920 <nop,nop,timestamp 598768 598452>
15:20:02.010813 IP 10.30.0.2.9 > 10.10.0.2.49547: 
    . ack 301 win 1048 <nop,nop,timestamp 598452 598768>
15:20:02.030940 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    P 401:501(100) ack 1 win 2920 <nop,nop,timestamp 598770 598452>
15:20:02.031429 IP 10.30.0.2.9 > 10.10.0.2.49547: 
    . ack 301 win 1048 <nop,nop,timestamp 598456 598768,nop,nop,sack 1 {401:501}>
15:20:02.042421 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    P 501:601(100) ack 1 win 2920 <nop,nop,timestamp 598772 598456>
15:20:02.042846 IP 10.30.0.2.9 > 10.10.0.2.49547: 
    . ack 301 win 1048 <nop,nop,timestamp 598458 598768,nop,nop,sack 1 {401:601}>
15:20:02.050839 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    P 601:701(100) ack 1 win 2920 <nop,nop,timestamp 598772 598458>
15:20:02.051179 IP 10.30.0.2.9 > 10.10.0.2.49547: 
    . ack 301 win 1048 <nop,nop,timestamp 598459 598768,nop,nop,sack 1 {401:701}>
15:20:02.051933 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    P 301:401(100) ack 1 win 2920 <nop,nop,timestamp 598772 598459>
15:20:02.052342 IP 10.30.0.2.9 > 10.10.0.2.49547: 
    . ack 701 win 1048 <nop,nop,timestamp 598459 598772>
15:20:02.063277 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    P 701:801(100) ack 1 win 2920 <nop,nop,timestamp 598774 598459>
15:20:02.063578 IP 10.30.0.2.9 > 10.10.0.2.49547: 
    . ack 801 win 1048 <nop,nop,timestamp 598460 598774>
15:20:02.320548 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    P 701:801(100) ack 1 win 2920 <nop,nop,timestamp 598799 598459>
15:20:02.321023 IP 10.30.0.2.9 > 10.10.0.2.49547: 
    . ack 801 win 1048 <nop,nop,timestamp 598485 598799,nop,nop,sack 1 {701:801}>
15:20:02.321897 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    . 801:1325(524) ack 1 win 2920 <nop,nop,timestamp 598799 598485>
15:20:02.321925 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    . 1325:1849(524) ack 1 win 2920 <nop,nop,timestamp 598799 598485>
15:20:02.322487 IP 10.30.0.2.9 > 10.10.0.2.49547: 
    . ack 1325 win 1572 <nop,nop,timestamp 598485 598799>
15:20:02.322528 IP 10.30.0.2.9 > 10.10.0.2.49547: 
    . ack 1849 win 2096 <nop,nop,timestamp 598485 598799>
15:20:02.323336 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    . 1849:2373(524) ack 1 win 2920 <nop,nop,timestamp 598799 598485>
15:20:02.323357 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    . 2373:2897(524) ack 1 win 2920 <nop,nop,timestamp 598799 598485>
15:20:02.323386 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    FP 2897:3001(104) ack 1 win 2920 <nop,nop,timestamp 598799 598485>
15:20:02.323722 IP 10.30.0.2.9 > 10.10.0.2.49547: 
    . ack 2373 win 2620 <nop,nop,timestamp 598485 598799>
15:20:02.323731 IP 10.30.0.2.9 > 10.10.0.2.49547: 
    . ack 2897 win 3144 <nop,nop,timestamp 598485 598799>
15:20:02.327118 IP 10.30.0.2.9 > 10.10.0.2.49547: 
    F 1:1(0) ack 3002 win 3144 <nop,nop,timestamp 598485 598799>
15:20:02.327776 IP 10.10.0.2.49547 > 10.30.0.2.9: 
    . ack 2 win 2920 <nop,nop,timestamp 598799 598485>
\end{Verbatim}

Таймаут примерно 25 мс.

\section{Обычный повтор}

На с1 запускаем:
\begin{Verbatim}
tcpdump -n -i eth0  tcp >> tcpdump2.txt &
./nagle nodelay 10.30.0.2 9 1 30
\end{Verbatim}

Содержимое файла tcpdump2.txt
\begin{Verbatim} 
c1:~# cat tcpdump2.txt 
15:38:40.154894 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    S 2947295263:2947295263(0) win 5840 
        <mss 1460,sackOK,timestamp 710582 0,nop,wscale 1>
15:38:40.169078 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    S 2992632968:2992632968(0) ack 2947295264 win 2096 
        <mss 536,sackOK,timestamp 710269 710582,nop,wscale 1>
15:38:40.169118 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    . ack 1 win 2920 <nop,nop,timestamp 710583 710269>
15:38:40.170334 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 1:101(100) ack 1 win 2920 <nop,nop,timestamp 710583 710269>
15:38:40.171239 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 101 win 1048 <nop,nop,timestamp 710269 710583>
15:38:40.181185 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 101:201(100) ack 1 win 2920 <nop,nop,timestamp 710585 710269>
15:38:40.182028 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 201 win 1048 <nop,nop,timestamp 710269 710585>
15:38:40.185954 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 201:301(100) ack 1 win 2920 <nop,nop,timestamp 710586 710269>
15:38:40.187105 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 301 win 1048 <nop,nop,timestamp 710269 710586>
15:38:40.196411 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 301:401(100) ack 1 win 2920 <nop,nop,timestamp 710587 710269>
15:38:40.197611 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 401 win 1048 <nop,nop,timestamp 710273 710587>
15:38:40.205783 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 401:501(100) ack 1 win 2920 <nop,nop,timestamp 710588 710273>
15:38:40.207032 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 501 win 1048 <nop,nop,timestamp 710274 710588>
15:38:40.216580 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 501:601(100) ack 1 win 2920 <nop,nop,timestamp 710589 710274>
15:38:40.217924 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 601 win 1048 <nop,nop,timestamp 710275 710589>
15:38:40.225583 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 601:701(100) ack 1 win 2920 <nop,nop,timestamp 710590 710275>
15:38:40.226892 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 701 win 1048 <nop,nop,timestamp 710276 710590>
15:38:40.236623 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 701:801(100) ack 1 win 2920 <nop,nop,timestamp 710591 710276>
15:38:40.239381 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 801 win 1048 <nop,nop,timestamp 710277 710591>
15:38:40.245402 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 801:901(100) ack 1 win 2920 <nop,nop,timestamp 710592 710277>
15:38:40.246363 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 901 win 1048 <nop,nop,timestamp 710278 710592>
15:38:40.256076 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 901:1001(100) ack 1 win 2920 <nop,nop,timestamp 710593 710278>
15:38:40.257359 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 1001 win 1048 <nop,nop,timestamp 710279 710593>
15:38:40.266326 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 1001:1101(100) ack 1 win 2920 <nop,nop,timestamp 710594 710279>
15:38:40.267599 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 1101 win 1048 <nop,nop,timestamp 710280 710594>
15:38:40.276151 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 1101:1201(100) ack 1 win 2920 <nop,nop,timestamp 710595 710280>
15:38:40.277343 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 1201 win 1048 <nop,nop,timestamp 710281 710595>
15:38:40.286303 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 1201:1301(100) ack 1 win 2920 <nop,nop,timestamp 710596 710281>
15:38:40.287651 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 1301 win 1048 <nop,nop,timestamp 710282 710596>
15:38:40.296007 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 1301:1401(100) ack 1 win 2920 <nop,nop,timestamp 710597 710282>
15:38:40.297285 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 1401 win 1048 <nop,nop,timestamp 710283 710597>
15:38:40.306421 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 1401:1501(100) ack 1 win 2920 <nop,nop,timestamp 710598 710283>
15:38:40.307705 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 1501 win 1048 <nop,nop,timestamp 710284 710598>
15:38:40.315824 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 1501:1601(100) ack 1 win 2920 <nop,nop,timestamp 710599 710284>
15:38:40.316978 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 1601 win 1048 <nop,nop,timestamp 710285 710599>
15:38:40.326470 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 1601:1701(100) ack 1 win 2920 <nop,nop,timestamp 710600 710285>
15:38:40.327849 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 1701 win 1048 <nop,nop,timestamp 710286 710600>
15:38:40.335988 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 1701:1801(100) ack 1 win 2920 <nop,nop,timestamp 710601 710286>
15:38:40.337273 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 1801 win 1048 <nop,nop,timestamp 710287 710601>
15:38:40.346589 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 1801:1901(100) ack 1 win 2920 <nop,nop,timestamp 710602 710287>
15:38:40.347812 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 1901 win 1048 <nop,nop,timestamp 710288 710602>
15:38:40.355528 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 1901:2001(100) ack 1 win 2920 <nop,nop,timestamp 710603 710288>
15:38:40.356758 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 2001 win 1048 <nop,nop,timestamp 710289 710603>
15:38:40.366524 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 2001:2101(100) ack 1 win 2920 <nop,nop,timestamp 710604 710289>
15:38:40.367838 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 2101 win 1048 <nop,nop,timestamp 710290 710604>
15:38:40.375428 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 2101:2201(100) ack 1 win 2920 <nop,nop,timestamp 710605 710290>
15:38:40.376622 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 2201 win 1048 <nop,nop,timestamp 710291 710605>
15:38:40.386424 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 2201:2301(100) ack 1 win 2920 <nop,nop,timestamp 710606 710291>
15:38:40.387710 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 2301 win 1048 <nop,nop,timestamp 710292 710606>
15:38:40.395720 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 2301:2401(100) ack 1 win 2920 <nop,nop,timestamp 710607 710292>
15:38:40.397074 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 2401 win 1048 <nop,nop,timestamp 710293 710607>
15:38:40.406557 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 2401:2501(100) ack 1 win 2920 <nop,nop,timestamp 710608 710293>
15:38:40.407915 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 2501 win 1048 <nop,nop,timestamp 710294 710608>
15:38:40.415609 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 2501:2601(100) ack 1 win 2920 <nop,nop,timestamp 710609 710294>
15:38:40.416868 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 2601 win 1048 <nop,nop,timestamp 710295 710609>
15:38:40.426578 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 2601:2701(100) ack 1 win 2920 <nop,nop,timestamp 710610 710295>
15:38:40.427762 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 2701 win 1048 <nop,nop,timestamp 710296 710610>
15:38:40.435347 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 2701:2801(100) ack 1 win 2920 <nop,nop,timestamp 710610 710296>
15:38:40.436607 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 2801 win 1048 <nop,nop,timestamp 710297 710610>
15:38:40.446546 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 2801:2901(100) ack 1 win 2920 <nop,nop,timestamp 710612 710297>
15:38:40.455339 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 2901:3001(100) ack 1 win 2920 <nop,nop,timestamp 710612 710297>
15:38:40.456338 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 2801 win 1048 <nop,nop,timestamp 710298 710610,nop,nop,sack 1 {2901:3001}>
15:38:40.467259 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    F 3001:3001(0) ack 1 win 2920 <nop,nop,timestamp 710614 710298>
15:38:40.468263 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 2801 win 1048 <nop,nop,timestamp 710300 710610,nop,nop,sack 1 {2901:3002}>
15:38:40.664758 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 2801:2901(100) ack 1 win 2920 <nop,nop,timestamp 710633 710300>
15:38:40.665889 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 3002 win 1048 <nop,nop,timestamp 710319 710633>
15:38:40.669213 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    F 1:1(0) ack 3002 win 1048 <nop,nop,timestamp 710319 710633>
15:38:40.669235 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    . ack 2 win 2920 <nop,nop,timestamp 710633 710319>
\end{Verbatim}

Дамп на с3 на eth1 можно увидеть, что теряются пакеты.

\begin{Verbatim}
c3:~# /etc/drop 60
I will drop every 60 packet (counting from 1).
c3:~# tcpdump -n -i eth1 tcp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth1, link-type EN10MB (Ethernet), capture size 96 bytes
15:38:40.157202 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    S 2947295263:2947295263(0) win 5840 
        <mss 536,sackOK,timestamp 710582 0,nop,wscale 1>
15:38:40.157677 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    S 2992632968:2992632968(0) ack 2947295264 win 2096 
        <mss 536,sackOK,timestamp 710269 710582,nop,wscale 1>
15:38:40.164885 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    . ack 1 win 2920 <nop,nop,timestamp 710583 710269>
15:38:40.165901 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 1:101(100) ack 1 win 2920 <nop,nop,timestamp 710583 710269>
15:38:40.166327 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 101 win 1048 <nop,nop,timestamp 710269 710583>
15:38:40.176852 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 101:201(100) ack 1 win 2920 <nop,nop,timestamp 710585 710269>
15:38:40.177128 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 201 win 1048 <nop,nop,timestamp 710269 710585>
15:38:40.181718 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 201:301(100) ack 1 win 2920 <nop,nop,timestamp 710586 710269>
15:38:40.182093 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 301 win 1048 <nop,nop,timestamp 710269 710586>
15:38:40.192157 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 301:401(100) ack 1 win 2920 <nop,nop,timestamp 710587 710269>
15:38:40.192557 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 401 win 1048 <nop,nop,timestamp 710273 710587>
15:38:40.201537 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 401:501(100) ack 1 win 2920 <nop,nop,timestamp 710588 710273>
15:38:40.201894 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 501 win 1048 <nop,nop,timestamp 710274 710588>
15:38:40.212316 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 501:601(100) ack 1 win 2920 <nop,nop,timestamp 710589 710274>
15:38:40.212750 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 601 win 1048 <nop,nop,timestamp 710275 710589>
15:38:40.221266 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 601:701(100) ack 1 win 2920 <nop,nop,timestamp 710590 710275>
15:38:40.221659 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 701 win 1048 <nop,nop,timestamp 710276 710590>
15:38:40.232231 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 701:801(100) ack 1 win 2920 <nop,nop,timestamp 710591 710276>
15:38:40.234449 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 801 win 1048 <nop,nop,timestamp 710277 710591>
15:38:40.241044 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 801:901(100) ack 1 win 2920 <nop,nop,timestamp 710592 710277>
15:38:40.241456 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 901 win 1048 <nop,nop,timestamp 710278 710592>
15:38:40.251794 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 901:1001(100) ack 1 win 2920 <nop,nop,timestamp 710593 710278>
15:38:40.252274 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 1001 win 1048 <nop,nop,timestamp 710279 710593>
15:38:40.262116 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 1001:1101(100) ack 1 win 2920 <nop,nop,timestamp 710594 710279>
15:38:40.262554 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 1101 win 1048 <nop,nop,timestamp 710280 710594>
15:38:40.271859 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 1101:1201(100) ack 1 win 2920 <nop,nop,timestamp 710595 710280>
15:38:40.272252 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 1201 win 1048 <nop,nop,timestamp 710281 710595>
15:38:40.282087 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 1201:1301(100) ack 1 win 2920 <nop,nop,timestamp 710596 710281>
15:38:40.282583 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 1301 win 1048 <nop,nop,timestamp 710282 710596>
15:38:40.291713 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 1301:1401(100) ack 1 win 2920 <nop,nop,timestamp 710597 710282>
15:38:40.292146 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 1401 win 1048 <nop,nop,timestamp 710283 710597>
15:38:40.302182 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 1401:1501(100) ack 1 win 2920 <nop,nop,timestamp 710598 710283>
15:38:40.302572 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 1501 win 1048 <nop,nop,timestamp 710284 710598>
15:38:40.311557 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 1501:1601(100) ack 1 win 2920 <nop,nop,timestamp 710599 710284>
15:38:40.311939 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 1601 win 1048 <nop,nop,timestamp 710285 710599>
15:38:40.322279 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 1601:1701(100) ack 1 win 2920 <nop,nop,timestamp 710600 710285>
15:38:40.322773 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 1701 win 1048 <nop,nop,timestamp 710286 710600>
15:38:40.331730 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 1701:1801(100) ack 1 win 2920 <nop,nop,timestamp 710601 710286>
15:38:40.332143 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 1801 win 1048 <nop,nop,timestamp 710287 710601>
15:38:40.342345 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 1801:1901(100) ack 1 win 2920 <nop,nop,timestamp 710602 710287>
15:38:40.342771 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 1901 win 1048 <nop,nop,timestamp 710288 710602>
15:38:40.351271 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 1901:2001(100) ack 1 win 2920 <nop,nop,timestamp 710603 710288>
15:38:40.351712 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 2001 win 1048 <nop,nop,timestamp 710289 710603>
15:38:40.362213 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 2001:2101(100) ack 1 win 2920 <nop,nop,timestamp 710604 710289>
15:38:40.362802 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 2101 win 1048 <nop,nop,timestamp 710290 710604>
15:38:40.371060 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 2101:2201(100) ack 1 win 2920 <nop,nop,timestamp 710605 710290>
15:38:40.371551 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 2201 win 1048 <nop,nop,timestamp 710291 710605>
15:38:40.382200 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 2201:2301(100) ack 1 win 2920 <nop,nop,timestamp 710606 710291>
15:38:40.382654 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 2301 win 1048 <nop,nop,timestamp 710292 710606>
15:38:40.391410 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 2301:2401(100) ack 1 win 2920 <nop,nop,timestamp 710607 710292>
15:38:40.391942 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 2401 win 1048 <nop,nop,timestamp 710293 710607>
15:38:40.402339 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 2401:2501(100) ack 1 win 2920 <nop,nop,timestamp 710608 710293>
15:38:40.402767 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 2501 win 1048 <nop,nop,timestamp 710294 710608>
15:38:40.411242 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 2501:2601(100) ack 1 win 2920 <nop,nop,timestamp 710609 710294>
15:38:40.411694 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 2601 win 1048 <nop,nop,timestamp 710295 710609>
15:38:40.422306 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 2601:2701(100) ack 1 win 2920 <nop,nop,timestamp 710610 710295>
15:38:40.422756 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 2701 win 1048 <nop,nop,timestamp 710296 710610>
15:38:40.431036 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 2701:2801(100) ack 1 win 2920 <nop,nop,timestamp 710610 710296>
15:38:40.431485 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 2801 win 1048 <nop,nop,timestamp 710297 710610>
15:38:40.450967 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 2901:3001(100) ack 1 win 2920 <nop,nop,timestamp 710612 710297>
15:38:40.451360 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 2801 win 1048 <nop,nop,timestamp 710298 710610,nop,nop,sack 1 {2901:3001}>
15:38:40.462889 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    F 3001:3001(0) ack 1 win 2920 <nop,nop,timestamp 710614 710298>
15:38:40.463284 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 2801 win 1048 <nop,nop,timestamp 710300 710610,nop,nop,sack 1 {2901:3002}>
15:38:40.660447 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    P 2801:2901(100) ack 1 win 2920 <nop,nop,timestamp 710633 710300>
15:38:40.660844 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    . ack 3002 win 1048 <nop,nop,timestamp 710319 710633>
15:38:40.664278 IP 10.30.0.2.9 > 10.10.0.2.35899: 
    F 1:1(0) ack 3002 win 1048 <nop,nop,timestamp 710319 710633>
15:38:40.664724 IP 10.10.0.2.35899 > 10.30.0.2.9: 
    . ack 2 win 2920 <nop,nop,timestamp 710633 710319>
\end{Verbatim}

Таймаут примерно 220 мс.

\section{Опыт с PMTU}

Дамп на c2 eth0.

\begin{Verbatim}
c2:~# tcpdump -n -i eth0 tcp or icmp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
15:58:22.554862 IP 10.10.0.2.53658 > 10.50.0.2.9: 
    S 3900967142:3900967142(0) win 5840 
        <mss 1460,sackOK,timestamp 14071 0,nop,wscale 1>
15:58:22.555685 IP 10.50.0.2.9 > 10.10.0.2.53658: 
    S 3894197119:3894197119(0) ack 3900967143 win 5792
         <mss 1460,sackOK,timestamp 13647 14071,nop,wscale 1>
15:58:22.555928 IP 10.10.0.2.53658 > 10.50.0.2.9: 
    . ack 1 win 2920 <nop,nop,timestamp 14071 13647>
15:58:22.687103 IP 10.10.0.2.53658 > 10.50.0.2.9: 
    . 1:1449(1448) ack 1 win 2920 <nop,nop,timestamp 14087 13647>
15:58:22.687157 IP 10.10.0.1 > 10.10.0.2: 
    ICMP 10.50.0.2 unreachable - need to frag (mtu 1492), length 556
15:58:22.687542 IP 10.10.0.2.53658 > 10.50.0.2.9: 
    . 1:1441(1440) ack 1 win 2920 <nop,nop,timestamp 14087 13647>
15:58:22.687713 IP 10.10.0.2.53658 > 10.50.0.2.9: 
    . 1441:1449(8) ack 1 win 2920 <nop,nop,timestamp 14087 13647>
15:58:22.687977 IP 10.20.0.2 > 10.10.0.2: 
    ICMP 10.50.0.2 unreachable - need to frag (mtu 576), length 556
15:58:22.688774 IP 10.50.0.2.9 > 10.10.0.2.53658: 
    . ack 1 win 2896 <nop,nop,timestamp 13660 14071,nop,nop,sack 1 {1441:1449}>
15:58:22.689075 IP 10.10.0.2.53658 > 10.50.0.2.9: 
    . 1:525(524) ack 1 win 2920 <nop,nop,timestamp 14087 13660>
15:58:22.689109 IP 10.10.0.2.53658 > 10.50.0.2.9: 
    . 525:1049(524) ack 1 win 2920 <nop,nop,timestamp 14087 13660>
15:58:22.689120 IP 10.10.0.2.53658 > 10.50.0.2.9: 
    . 1049:1441(392) ack 1 win 2920 <nop,nop,timestamp 14087 13660>
15:58:22.689997 IP 10.50.0.2.9 > 10.10.0.2.53658: 
    . ack 525 win 3432 <nop,nop,timestamp 13660 14087,nop,nop,sack 1 {1441:1449}>
15:58:22.690019 IP 10.50.0.2.9 > 10.10.0.2.53658: 
    . ack 1049 win 3956 <nop,nop,timestamp 13660 14087,nop,nop,sack 1 {1441:1449}>
15:58:22.690028 IP 10.50.0.2.9 > 10.10.0.2.53658: 
    . ack 1449 win 4480 <nop,nop,timestamp 13660 14087>
15:58:22.737367 IP 10.10.0.2.53658 > 10.50.0.2.9: 
    . 1449:1973(524) ack 1 win 2920 <nop,nop,timestamp 14093 13660>
15:58:22.738684 IP 10.50.0.2.9 > 10.10.0.2.53658: 
    . ack 1973 win 5004 <nop,nop,timestamp 13666 14093>
15:58:22.787442 IP 10.10.0.2.53658 > 10.50.0.2.9: 
    . 1973:2497(524) ack 1 win 2920 <nop,nop,timestamp 14098 13666>
15:58:22.788870 IP 10.50.0.2.9 > 10.10.0.2.53658: 
    . ack 2497 win 5528 <nop,nop,timestamp 13670 14098>
15:58:22.848623 IP 10.10.0.2.53658 > 10.50.0.2.9: 
    FP 2497:3001(504) ack 1 win 2920 <nop,nop,timestamp 14104 13670>
15:58:22.853085 IP 10.50.0.2.9 > 10.10.0.2.53658: 
    F 1:1(0) ack 3002 win 6052 <nop,nop,timestamp 13676 14104>
15:58:22.853299 IP 10.10.0.2.53658 > 10.50.0.2.9: 
    . ack 2 win 2920 <nop,nop,timestamp 14104 13676>
\end{Verbatim}

Дамп на c6.

\begin{Verbatim}
c6:~# tcpdump -n -i eth0 tcp or icmp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
15:58:22.551257 IP 10.10.0.2.53658 > 10.50.0.2.9: 
    S 3900967142:3900967142(0) win 5840 
        <mss 1460,sackOK,timestamp 14071 0,nop,wscale 1>
15:58:22.551291 IP 10.50.0.2.9 > 10.10.0.2.53658: 
    S 3894197119:3894197119(0) ack 3900967143 win 5792 
        <mss 1460,sackOK,timestamp 13647 14071,nop,wscale 1>
15:58:22.552346 IP 10.10.0.2.53658 > 10.50.0.2.9: 
    . ack 1 win 2920 <nop,nop,timestamp 14071 13647>
15:58:22.684228 IP 10.10.0.2.53658 > 10.50.0.2.9: 
    . 1441:1449(8) ack 1 win 2920 <nop,nop,timestamp 14087 13647>
15:58:22.684280 IP 10.50.0.2.9 > 10.10.0.2.53658: 
    . ack 1 win 2896 <nop,nop,timestamp 13660 14071,nop,nop,sack 1 {1441:1449}>
15:58:22.685630 IP 10.10.0.2.53658 > 10.50.0.2.9: 
    . 1:525(524) ack 1 win 2920 <nop,nop,timestamp 14087 13660>
15:58:22.685647 IP 10.10.0.2.53658 > 10.50.0.2.9: 
    . 525:1049(524) ack 1 win 2920 <nop,nop,timestamp 14087 13660>
15:58:22.685651 IP 10.10.0.2.53658 > 10.50.0.2.9: 
    . 1049:1441(392) ack 1 win 2920 <nop,nop,timestamp 14087 13660>
15:58:22.685693 IP 10.50.0.2.9 > 10.10.0.2.53658: 
    . ack 525 win 3432 <nop,nop,timestamp 13660 14087,nop,nop,sack 1 {1441:1449}>
15:58:22.685716 IP 10.50.0.2.9 > 10.10.0.2.53658: 
    . ack 1049 win 3956 <nop,nop,timestamp 13660 14087,nop,nop,sack 1 {1441:1449}>
15:58:22.685727 IP 10.50.0.2.9 > 10.10.0.2.53658: 
    . ack 1449 win 4480 <nop,nop,timestamp 13660 14087>
15:58:22.733969 IP 10.10.0.2.53658 > 10.50.0.2.9: 
    . 1449:1973(524) ack 1 win 2920 <nop,nop,timestamp 14093 13660>
15:58:22.734053 IP 10.50.0.2.9 > 10.10.0.2.53658: 
    . ack 1973 win 5004 <nop,nop,timestamp 13666 14093>
15:58:22.784100 IP 10.10.0.2.53658 > 10.50.0.2.9: 
    . 1973:2497(524) ack 1 win 2920 <nop,nop,timestamp 14098 13666>
15:58:22.784216 IP 10.50.0.2.9 > 10.10.0.2.53658: 
    . ack 2497 win 5528 <nop,nop,timestamp 13670 14098>
15:58:22.845099 IP 10.10.0.2.53658 > 10.50.0.2.9: 
    FP 2497:3001(504) ack 1 win 2920 <nop,nop,timestamp 14104 13670>
15:58:22.848656 IP 10.50.0.2.9 > 10.10.0.2.53658: 
    F 1:1(0) ack 3002 win 6052 <nop,nop,timestamp 13676 14104>
15:58:22.849624 IP 10.10.0.2.53658 > 10.50.0.2.9: 
    . ack 2 win 2920 <nop,nop,timestamp 14104 13676>
\end{Verbatim}

\section{Соединение с неверным портом}

С c1 пытаемся подключиться к порту 65499 на с4
\begin{Verbatim}
c1:~# telnet 10.50.0.2 65499
Trying 10.50.0.2...
telnet: Unable to connect to remote host: Connection refused
\end{Verbatim}

Дамп на с2.
\begin{Verbatim}
c2:~# tcpdump -n -i eth0 tcp or icmp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 96 bytes
16:20:24.261293 IP 10.10.0.2.49323 > 10.50.0.2.65499: 
    S 3144600115:3144600115(0) win 5840 
        <mss 1460,sackOK,timestamp 146240 0,nop,wscale 1>
16:20:24.262081 IP 10.50.0.2.65499 > 10.10.0.2.49323: 
    R 0:0(0) ack 3144600116 win 0
\end{Verbatim}

\end{document}
